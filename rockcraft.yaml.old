# See https://documentation.ubuntu.com/rockcraft/1.16.0/reference/extensions/flask-framework
# For questions or help, visit https://matrix.to/#/#12-factor-charms:ubuntu.com

name: canonicalwebteam.juju-logger
# see https://documentation.ubuntu.com/rockcraft/1.16.0/explanation/bases/
# for more information about bases and using 'bare' bases for chiselled rocks
base: ubuntu@22.04
version: "0.1"
summary: A Flask application to log Juju model data.
description: |
  This charm deploys a Flask application that collects and logs data from Juju models using the Juju Python client library.

  It connects to the Juju controller, retrieves information about the current model and applications, and logs this data for analysis and monitoring purposes.
platforms:
  amd64:

# see https://documentation.ubuntu.com/rockcraft/1.16.0/reference/extensions/flask-framework
# for more information.
extensions:
  - flask-framework
# uncomment the sections you need and adjust according to your requirements.
parts: # you need to uncomment this line to add or update any part.
  flask-framework/install-app:
    prime:
      - flask/app/.env
      - flask/app/app.py
      - flask/app/webapp
      - flask/app/templates
      - flask/app/static
      - flask/app/src
    override-build: |
      # Add the Grafana APT repository 
      sudo mkdir -p /etc/apt/keyrings/
      wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg > /dev/null
      echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee /etc/apt/sources.list.d/grafana.list

      # Update and install
      apt-get update
      apt-get install -y alloy

      craftctl default
